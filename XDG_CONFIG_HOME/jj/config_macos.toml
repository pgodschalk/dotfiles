[user]
name = "Patrick Godschalk"
email = "patrick@kernelpanics.nl"

[ui]
diff-formatter = ["difft", "--color=always", "$left", "$right"]
conflict-marker-style = "git"
merge-editor = "opendiff"
pager = ["delta", "--line-numbers", "--navigate"]

[aliases]
ai = [
  "util",
  "exec",
  "--",
  "sh",
  "-c",
  """
export OP_ACCOUNT='my.1password.eu'
export OPENAI_API_KEY='op://Private/sgjddcuzvgu3qbpzqqw6tn5lw4/credential'
if [ -z "$AICOMMIT_CONFIG_PATH" ]; then
  dir="$(pwd)"
  while [ "$dir" != "/" ]; do
    if [ -f "$dir/.config/aicommit2/config.ini" ]; then
      export AICOMMIT_CONFIG_PATH="$dir/.config/aicommit2/config.ini"
      break
    fi
    dir="$(dirname "$dir")"
  done
fi
tmpfile=$(mktemp)
op run -- aicommit2 --include-body --hook-mode "$tmpfile"
msg=$(sed \
  -e '/^# ü§ñ Generated by aicommit2/d' \
  -e '/^# -\\{20,\\}/d' \
  -e '/^# How to use:/d' \
  -e '/^# [0-9]\\. /d' \
  -e '/^# üìù Generated commit message:/d' \
  -e '1,/[^[:space:]]/{/^$/d;}' \
  "$tmpfile")
rm -f "$tmpfile"
jj describe --message "$msg"
jj describe
"""
]
b = ["branch"]
n = ["new"]
# Rebase the current branch onto the trunk.
retrunk = ["rebase", "-d", "trunk()"]
# Move the closest bookmark to the current commit. This is useful when working
# on a named branch, creating a bunch of commits, and then needing to update
# the bookmark before pushing.
tug = ["bookmark", "move", "--from", "closest_bookmark(@-)", "--to", "@-"]

[signing]
behavior = "own"
backend = "ssh"
key = "~/Library/Containers/com.maxgoedjen.Secretive.SecretAgent/Data/PublicKeys/9decc179f0af831a3ac203804d9310af.pub"

[signing.backends.ssh]
allowed-signers = "~/Library/Application Support/git/allowed-signers"

[git]
sign-on-push = true

[merge-tools.opendiff]
program = "opendiff"
merge-args = ["$left", "$right", "-ancestor", "$base", "-merge", "$output"]

[fsmonitor]
backend = "watchman"

[revset-aliases]
"closest_bookmark(to)" = "heads(::to & bookmarks())"
"fork_history(to, from)" = "fork_point(to | from)..@"

[template-aliases]
"format_timestamp(timestamp)" = "timestamp.ago()"
